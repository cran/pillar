<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Printing a tibble: Control and data flow</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Printing a tibble: Control and data
flow</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(pillar)</span></code></pre></div>
<p>What happens when a tibble is printed? This vignette documents the
control flow and the data flow, explains the design choices, and shows
the default implementation for the <code>&quot;tbl&quot;</code> class. It is
mainly of interest for implementers of table subclasses. Customizing the
formatting of a vector class in a tibble is described in
<code>vignette(&quot;pillar&quot;, package = &quot;vctrs&quot;)</code>. The different
customization options are showcased in
<code>vignette(&quot;extending&quot;)</code>.</p>
<div id="requirements" class="section level2">
<h2>Requirements</h2>
<ul>
<li><p>Fit into pre-specified width, distributing across multiple tiers
if necessary</p></li>
<li><p>Optionally shrink and stretch individual columns</p></li>
<li><p>Header, body and footer for the tibble</p>
<ul>
<li>Avoid recomputation of information</li>
</ul></li>
<li><p>Custom components for the pillars in a tibble, top-aligned</p>
<ul>
<li>The container, not the column vectors, determine the appearance</li>
</ul></li>
<li><p>Customization of the entire output and of the pillars</p></li>
<li><p>Support for data frame columns (packed data frames) and
matrix/array columns</p></li>
<li><p>Pillars are always shown from left to right, no “holes” in the
colonnade</p>
<ul>
<li>If the first column consumes all available space, the remaining
columns are not shown, even if they all would fit if the first column is
omitted.</li>
</ul></li>
<li><p>Printing pillars should take time proportional to the number of
characters printed, and be “fast enough”.</p></li>
</ul>
</div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The overall control and data flow are illustrated in the diagram
below. Boxes are functions and methods. Solid lines are function calls.
Dotted lines represent information that a function obtains via argument
or (in the case of options) queries actively.</p>
<pre><code>#&gt; Error in loadNamespace(x): there is no package called &#39;DiagrammeR&#39;</code></pre>
<p>The pillar package uses debugme for debugging. Activating debugging
for pillar is another way to track the control flow, see
<code>vignette(&quot;debugme&quot;)</code> for details.</p>
</div>
<div id="initialization" class="section level2">
<h2>Initialization</h2>
<p>A tibble is a list of columns of class <code>&quot;tbl_df&quot;</code> and
<code>&quot;tbl&quot;</code>. Printing is designed to work for non-data-frame
table-like objects such as lazy tables. The <code>print.tbl()</code>
method calls <code>format()</code> for the object and prints the
output.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">b =</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">c =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">d =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), <span class="at">e =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">print</span>(tbl, <span class="at">width =</span> <span class="dv">23</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt;       a   b$c     e</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; 1     1     4    10</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; 2     2     5    11</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; 3     3     6    12</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable:</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; #   b$d &lt;int&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="fu">str</span>(tbl)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; tibble [3 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt;  $ a: int [1:3] 1 2 3</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt;  $ b: tibble [3 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt;   ..$ c: int [1:3] 4 5 6</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt;   ..$ d: int [1:3] 7 8 9</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt;  $ e: int [1:3] 10 11 12</span></span></code></pre></div>
<details>
<summary>
Source code of <code>pillar:::print.tbl()</code>
</summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>print.tbl <span class="ot">&lt;-</span> <span class="cf">function</span> (x, <span class="at">width =</span> <span class="cn">NULL</span>, ..., <span class="at">n =</span> <span class="cn">NULL</span>, <span class="at">max_extra_cols =</span> <span class="cn">NULL</span>, </span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="at">max_footer_lines =</span> <span class="cn">NULL</span>) </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>{</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="fu">print_tbl</span>(x, width, ..., <span class="at">n =</span> n, <span class="at">max_extra_cols =</span> max_extra_cols, </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        <span class="at">max_footer_lines =</span> max_footer_lines)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>The <code>format.tbl()</code> method creates a setup object, and uses
that object to format header, body and footer.</p>
<details>
<summary>
Source code of <code>pillar:::format.tbl()</code>
</summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>format.tbl <span class="ot">&lt;-</span> <span class="cf">function</span> (x, <span class="at">width =</span> <span class="cn">NULL</span>, ..., <span class="at">n =</span> <span class="cn">NULL</span>, <span class="at">max_extra_cols =</span> <span class="cn">NULL</span>, </span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="at">max_footer_lines =</span> <span class="cn">NULL</span>) </span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>{</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="fu">format_tbl</span>(x, width, ..., <span class="at">n =</span> n, <span class="at">max_extra_cols =</span> max_extra_cols, </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        <span class="at">max_footer_lines =</span> max_footer_lines)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>While it’s possible to extend or override these methods for your
<code>&quot;tbl&quot;</code> subclass, often overriding the more specialized
methods shown below is sufficient.</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>Most of the work for formatting actually happens in
<code>tbl_format_setup()</code>. The desired output width is baked into
the setup object and must be available when calling. Setup objects print
like a tibble but with a clear separation of header, body, and
footer.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>setup <span class="ot">&lt;-</span> <span class="fu">tbl_format_setup</span>(tbl, <span class="at">width =</span> <span class="dv">24</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>setup</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; &lt;pillar_tbl_format_setup&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; &lt;tbl_format_header(setup)&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; &lt;tbl_format_body(setup)&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;       a   b$c     e</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; 1     1     4    10</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; 2     2     5    11</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; 3     3     6    12</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; &lt;tbl_format_footer(setup)&gt;</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable:</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; #   b$d &lt;int&gt;</span></span></code></pre></div>
<p>A setup object is required here to avoid computing information twice.
For instance, the dimensions shown in the header or the extra columns
displayed in the footer are available only after the body has been
computed.</p>
<p>The generic dispatches over the container, so that you can override
it if necessary. It is responsible for assigning default values to
arguments before passing them on to the method.</p>
<details>
<summary>
Source code of <code>tbl_format_setup()</code>
</summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>tbl_format_setup <span class="ot">&lt;-</span> <span class="cf">function</span> (x, <span class="at">width =</span> <span class="cn">NULL</span>, ..., <span class="at">setup =</span> <span class="fu">list</span>(<span class="at">tbl_sum =</span> <span class="fu">tbl_sum</span>(x)), </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="at">n =</span> <span class="cn">NULL</span>, <span class="at">max_extra_cols =</span> <span class="cn">NULL</span>, <span class="at">max_footer_lines =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="at">focus =</span> <span class="cn">NULL</span>) </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>{</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="st">&quot;!!!!DEBUG tbl_format_setup()&quot;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    width <span class="ot">&lt;-</span> <span class="fu">get_width_print</span>(width)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">get_n_print</span>(n, <span class="fu">tbl_nrow</span>(x))</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    max_extra_cols <span class="ot">&lt;-</span> <span class="fu">get_max_extra_cols</span>(max_extra_cols)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    max_footer_lines <span class="ot">&lt;-</span> <span class="fu">get_max_footer_lines</span>(max_footer_lines)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">tbl_format_setup_dispatch</span>(x, width, ..., <span class="at">setup =</span> setup, </span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>        <span class="at">n =</span> n, <span class="at">max_extra_cols =</span> max_extra_cols, <span class="at">max_footer_lines =</span> max_footer_lines, </span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>        <span class="at">focus =</span> focus)</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    <span class="fu">UseMethod</span>(<span class="st">&quot;tbl_format_setup&quot;</span>)</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>The default implementation converts the input to a data frame via
<code>as.data.frame(head(x))</code>, and returns an object constructed
with <code>new_tbl_format_setup()</code> that contains the data frame
and additional information. If you override this method, e.g. to
incorporate more information, you can add new items to the default setup
object, but you should not overwrite existing items.</p>
<details>
<summary>
Source code of <code>pillar:::tbl_format_setup.tbl()</code>
</summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>tbl_format_setup.tbl <span class="ot">&lt;-</span> <span class="cf">function</span> (x, width, ..., setup, n, max_extra_cols, max_footer_lines, </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    focus) </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>{</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="st">&quot;!!!!DEBUG tbl_format_setup.tbl()&quot;</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(setup)) {</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>        tbl_sum <span class="ot">&lt;-</span> <span class="fu">tbl_sum</span>(x)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">new_tbl_format_setup</span>(width, tbl_sum, <span class="at">rows_total =</span> <span class="cn">NA</span>))</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    }</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>        tbl_sum <span class="ot">&lt;-</span> setup<span class="sc">$</span>tbl_sum</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    }</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    rows <span class="ot">&lt;-</span> <span class="fu">tbl_nrow</span>(x)</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    lazy <span class="ot">&lt;-</span> <span class="fu">is.na</span>(rows)</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="cf">if</span> (lazy) {</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>        df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">head</span>(x, n <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">nrow</span>(df) <span class="sc">&lt;=</span> n) {</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>            rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>        }</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>            df <span class="ot">&lt;-</span> <span class="fu">vec_head</span>(df, n)</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>        }</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>    }</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>        df <span class="ot">&lt;-</span> <span class="fu">df_head</span>(x, n)</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>    }</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(rows)) {</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>        needs_dots <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(df) <span class="sc">&gt;=</span> n)</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>    }</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>        needs_dots <span class="ot">&lt;-</span> (rows <span class="sc">&gt;</span> n)</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>    }</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>    <span class="cf">if</span> (needs_dots) {</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>        rows_missing <span class="ot">&lt;-</span> rows <span class="sc">-</span> n</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>    }</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>        rows_missing <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>    }</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>    <span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>    colonnade <span class="ot">&lt;-</span> <span class="fu">ctl_colonnade</span>(df, <span class="at">has_row_id =</span> <span class="cf">if</span> (<span class="sc">!</span>lazy <span class="sc">&amp;&amp;</span> </span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>        <span class="fu">.row_names_info</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a>        <span class="st">&quot;*&quot;</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>    <span class="cf">else</span> <span class="cn">TRUE</span>, <span class="at">width =</span> width, <span class="at">controller =</span> x, <span class="at">focus =</span> focus)</span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>    body <span class="ot">&lt;-</span> colonnade<span class="sc">$</span>body</span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>    extra_cols <span class="ot">&lt;-</span> colonnade<span class="sc">$</span>extra_cols</span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>    extra_cols_total <span class="ot">&lt;-</span> <span class="fu">length</span>(extra_cols)</span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>    <span class="cf">if</span> (extra_cols_total <span class="sc">&gt;</span> max_extra_cols) {</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>        <span class="fu">length</span>(extra_cols) <span class="ot">&lt;-</span> max_extra_cols</span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a>    }</span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a>    abbrev_cols <span class="ot">&lt;-</span> colonnade<span class="sc">$</span>abbrev_cols</span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a>    <span class="fu">new_tbl_format_setup</span>(<span class="at">x =</span> x, <span class="at">df =</span> df, <span class="at">width =</span> width, <span class="at">tbl_sum =</span> tbl_sum, </span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a>        <span class="at">body =</span> body, <span class="at">rows_missing =</span> rows_missing, <span class="at">rows_total =</span> rows, </span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a>        <span class="at">extra_cols =</span> extra_cols, <span class="at">extra_cols_total =</span> extra_cols_total, </span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a>        <span class="at">max_footer_lines =</span> max_footer_lines, <span class="at">abbrev_cols =</span> abbrev_cols)</span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>At the core, the internal function <code>ctl_colonnade()</code>
composes the body. Its functionality and the customization points it
offers are detailed in the “Colonnade” section below.</p>
</div>
<div id="header-body-footer" class="section level2">
<h2>Header, body, footer</h2>
<p>The components of a tibble are formatted with
<code>tbl_format_*()</code> generics, which also dispatch on the
container to allow extension or overrides. They return a character
vector, with one element per line printed. The setup object is
required.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">tbl_format_header</span>(tbl, setup)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;# A tibble: 3 × 3&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">tbl_format_body</span>(tbl, setup)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt;       a   b$c     e</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; 1     1     4    10</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; 2     2     5    11</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; 3     3     6    12</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="fu">tbl_format_footer</span>(tbl, setup)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;# ℹ 1 more variable:&quot; &quot;#   b$d &lt;int&gt;&quot;</span></span></code></pre></div>
<p>(The body is returned as a classed object with a <code>print()</code>
method, it is still a <code>character()</code> under the hood.)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">tbl_format_body</span>(tbl, setup))</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;glue&quot;      &quot;character&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">tbl_format_body</span>(tbl, setup))</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;character&quot;</span></span></code></pre></div>
<p>Since most of the work already has been carried out in
<code>tbl_format_setup()</code>, the default implementations mostly
consist of code that styles and wraps the output.</p>
<details>
<summary>
Source code of <code>pillar:::tbl_format_header.tbl()</code>
</summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>tbl_format_header.tbl <span class="ot">&lt;-</span> <span class="cf">function</span> (x, setup, ...) </span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>{</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    named_header <span class="ot">&lt;-</span> setup<span class="sc">$</span>tbl_sum</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    focus <span class="ot">&lt;-</span> <span class="fu">attr</span>(x, <span class="st">&quot;pillar_focus&quot;</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(focus)) {</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>        named_header <span class="ot">&lt;-</span> <span class="fu">c</span>(named_header, <span class="st">`</span><span class="at">Focus columns</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">collapse</span>(<span class="fu">tick_if_needed</span>(focus)))</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    }</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">names2</span>(named_header) <span class="sc">==</span> <span class="st">&quot;&quot;</span>)) {</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>        header <span class="ot">&lt;-</span> named_header</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    }</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>        header <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">align</span>(<span class="fu">paste0</span>(<span class="fu">names2</span>(named_header), <span class="st">&quot;:&quot;</span>), </span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>            <span class="at">space =</span> NBSP), <span class="st">&quot; &quot;</span>, named_header)</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    }</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    <span class="fu">style_subtle</span>(<span class="fu">format_comment</span>(header, <span class="at">width =</span> setup<span class="sc">$</span>width))</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>}</span></code></pre></div>
</details>
<details>
<summary>
Source code of <code>pillar:::tbl_format_body.tbl()</code>
</summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>tbl_format_body.tbl <span class="ot">&lt;-</span> <span class="cf">function</span> (x, setup, ...) </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>{</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="fu">force</span>(setup)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    setup<span class="sc">$</span>body</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>}</span></code></pre></div>
</details>
<details>
<summary>
Source code of <code>pillar:::tbl_format_footer.tbl()</code>
</summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>tbl_format_footer.tbl <span class="ot">&lt;-</span> <span class="cf">function</span> (x, setup, ...) </span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>{</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    footer <span class="ot">&lt;-</span> <span class="fu">format_footer</span>(x, setup)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    footer_comment <span class="ot">&lt;-</span> <span class="fu">wrap_footer_bullet</span>(footer, setup)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    footer_advice <span class="ot">&lt;-</span> <span class="fu">format_footer_advice</span>(x, setup)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    footer_advice_comment <span class="ot">&lt;-</span> <span class="fu">wrap_footer_bullet</span>(footer_advice, </span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>        setup, <span class="at">lines =</span> <span class="dv">1</span>, <span class="at">ellipsis =</span> <span class="cn">FALSE</span>, <span class="at">bullet =</span> symbol<span class="sc">$</span>info)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    <span class="fu">style_subtle</span>(<span class="fu">c</span>(footer_comment, footer_advice_comment))</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<div id="colonnade" class="section level2">
<h2>Colonnade</h2>
<p>The internal function <code>ctl_colonnade()</code> composes the body.
It performs the following tasks:</p>
<ol style="list-style-type: decimal">
<li>Create a pillar object for every top-level column that fits, using
the minimum width, via <code>ctl_new_pillar_list()</code>,
<code>ctl_new_pillar()</code> and ultimately <code>pillar()</code> and
<code>pillar_shaft()</code></li>
<li>Determine the number of tiers and the width for each tier</li>
<li>Distribute the pillars across the tiers, assigning a width to each
pillar.</li>
<li>Format each pillar via its <code>format()</code> function, passing
the now known width.</li>
<li>Combine the formatted pillars horizontally.</li>
<li>Combine the tiers vertically.</li>
<li>Return the formatted body, and the columns that could not fit.</li>
</ol>
<p>In the following, the first and the fourth steps are discussed.</p>
</div>
<div id="creating-pillar-objects" class="section level2">
<h2>Creating pillar objects</h2>
<p>The initial tibble is passed to <code>ctl_new_pillar_list()</code>,
which eventually calls <code>ctl_new_pillar()</code> once or several
times. For each top-level column, one pillar object is constructed. The
loop is terminated when the available width is exhausted even
considering the minimum width.</p>
<div id="pillar-lists" class="section level3">
<h3>Pillar lists</h3>
<p>The <code>ctl_new_pillar_list()</code> generic dispatches on the
container:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">ctl_new_pillar_list</span>(tbl, tbl<span class="sc">$</span>a, <span class="at">width =</span> <span class="dv">20</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; &lt;pillar&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; &lt;int&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt;     1</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt;     2</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt;     3</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;remaining_width&quot;)</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; [1] 14</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;simple&quot;)</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="fu">ctl_new_pillar_list</span>(tbl, tbl<span class="sc">$</span>b, <span class="at">width =</span> <span class="dv">20</span>)</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt; &lt;pillar&gt;</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt;     c</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt; &lt;int&gt;</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt;     4</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt;     5</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="co">#&gt;     6</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="co">#&gt; &lt;pillar&gt;</span></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="co">#&gt;     d</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a><span class="co">#&gt; &lt;int&gt;</span></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a><span class="co">#&gt;     7</span></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a><span class="co">#&gt;     8</span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a><span class="co">#&gt;     9</span></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;extra&quot;)</span></span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a><span class="co">#&gt; character(0)</span></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;remaining_width&quot;)</span></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a><span class="co">#&gt; [1] 8</span></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;simple&quot;)</span></span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>In a tibble, each column can be a data frame, matrix, or even array
itself, such columns are called <em>compound columns</em>. Such columns
are decomposed into sub-pillars and returned as a list of pillars.
Regular vectors are forwarded to <code>ctl_new_pillar()</code> and
returned as list of length one. Implementers of <code>&quot;tbl&quot;</code>
subclasses will rarely if ever need to extend or override this
method.</p>
<details>
<summary>
Source code of <code>pillar:::ctl_new_pillar_list.tbl()</code>
</summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>ctl_new_pillar_list.tbl <span class="ot">&lt;-</span> <span class="cf">function</span> (controller, x, width, ..., <span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">first_pillar =</span> <span class="cn">NULL</span>) </span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>{</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    <span class="st">&quot;!!!!DEBUG ctl_new_pillar_list.tbl(`v(width)`, `v(title)`)&quot;</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.data.frame</span>(x)) {</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>        <span class="fu">new_data_frame_pillar_list</span>(x, controller, width, <span class="at">title =</span> title, </span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>            <span class="at">first_pillar =</span> first_pillar)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    }</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.matrix</span>(x) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">inherits</span>(x, <span class="fu">c</span>(<span class="st">&quot;Surv&quot;</span>, <span class="st">&quot;Surv2&quot;</span>))) {</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>        <span class="fu">new_matrix_pillar_list</span>(x, controller, width, <span class="at">title =</span> title, </span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>            <span class="at">first_pillar =</span> first_pillar)</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>    }</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.array</span>(x) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(<span class="fu">dim</span>(x)) <span class="sc">&gt;</span> <span class="dv">2</span>) {</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>        <span class="fu">new_array_pillar_list</span>(x, controller, width, <span class="at">title =</span> title, </span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>            <span class="at">first_pillar =</span> first_pillar)</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>    }</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(first_pillar)) {</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>            first_pillar <span class="ot">&lt;-</span> <span class="fu">ctl_new_pillar</span>(controller, x, width, </span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>                ..., <span class="at">title =</span> <span class="fu">prepare_title</span>(title))</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>        }</span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>        <span class="fu">new_single_pillar_list</span>(first_pillar, width)</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>    }</span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<div id="simple-pillars" class="section level3">
<h3>Simple pillars</h3>
<p>The <code>ctl_new_pillar()</code> method is called for columns that
are not data frames or arrays, and also dispatches over the
container.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">ctl_new_pillar</span>(tbl, tbl<span class="sc">$</span>a, <span class="at">width =</span> <span class="dv">20</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; &lt;pillar&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; &lt;int&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt;     1</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt;     2</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt;     3</span></span></code></pre></div>
<details>
<summary>
Source code of <code>pillar:::ctl_new_pillar.tbl()</code>
</summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>ctl_new_pillar.tbl <span class="ot">&lt;-</span> <span class="cf">function</span> (controller, x, width, ..., <span class="at">title =</span> <span class="cn">NULL</span>) </span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>{</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>    <span class="st">&quot;!!!!DEBUG ctl_new_pillar.tbl(`v(width)`, `v(title)`)&quot;</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    <span class="fu">pillar</span>(x, title, <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(width)) </span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>        <span class="fu">max0</span>(width))</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>The default method calls <code>pillar()</code> directly, passing the
maximum width available.</p>
<details>
<summary>
Source code of <code>pillar()</code>
</summary>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>pillar <span class="ot">&lt;-</span> <span class="cf">function</span> (x, <span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">width =</span> <span class="cn">NULL</span>, ...) </span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>{</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    <span class="st">&quot;!!!!DEBUG pillar(`v(class(x))`, `v(title)`, `v(width)`)&quot;</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>    <span class="fu">pillar_from_shaft</span>(<span class="fu">new_pillar_title</span>(title), <span class="fu">new_pillar_type</span>(x), </span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>        <span class="fu">pillar_shaft</span>(x, ...), width)</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Formatting for title and type is provided by
<code>new_pillar_title()</code> and <code>new_pillar_type()</code>. The
body can be customized by implementing <code>pillar_shaft()</code> for a
vector class, see <code>vignette(&quot;pillar&quot;, package = &quot;vctrs&quot;)</code> for
details. If title or type don’t fit the available width,
<code>pillar_shaft()</code> is never called.</p>
<p>This function now returns <code>NULL</code> if the width is
insufficient to contain the data. It is possible to change the
appearance of pillars by overriding or extending
<code>ctl_new_pillar()</code>.</p>
</div>
<div id="components" class="section level3">
<h3>Components</h3>
<p>Pillar objects share the same structure and are ultimately
constructed with <code>new_pillar()</code>.</p>
<details>
<summary>
Source code of <code>new_pillar()</code>
</summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>new_pillar <span class="ot">&lt;-</span> <span class="cf">function</span> (components, ..., <span class="at">width =</span> <span class="cn">NULL</span>, <span class="at">class =</span> <span class="cn">NULL</span>, <span class="at">extra =</span> <span class="fu">deprecated</span>()) </span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>{</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    <span class="st">&quot;!!!!DEBUG new_pillar(`v(width)`, `v(class)`)&quot;</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_present</span>(extra)) {</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>        <span class="fu">deprecate_warn</span>(<span class="st">&quot;1.7.0&quot;</span>, <span class="st">&quot;pillar::new_pillar(extra = )&quot;</span>)</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    }</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>    <span class="fu">check_dots_empty</span>()</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(components) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is_named</span>(components)) {</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>        <span class="fu">abort</span>(<span class="st">&quot;All components must have names.&quot;</span>)</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>    }</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>    <span class="fu">structure</span>(components, <span class="at">width =</span> width, <span class="at">class =</span> <span class="fu">c</span>(class, <span class="st">&quot;pillar&quot;</span>))</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>A pillar is stored as a list of components. Each pillar represents
only one simple (atomic) column, compound columns are always represented
as multiple pillar objects.</p>
</div>
</div>
<div id="formatting-pillars" class="section level2">
<h2>Formatting pillars</h2>
<p>When a pillar object is constructed, it has a minimum and a desired
(maximum) width. Because it depends on the number and width of other
pillar objects that may not be even constructed, the final width is not
known yet. It is passed to <code>format()</code>, which uses the desired
width if empty:</p>
<details>
<summary>
Source code of <code>pillar:::format.pillar()</code>
</summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>format.pillar <span class="ot">&lt;-</span> <span class="cf">function</span> (x, <span class="at">width =</span> <span class="cn">NULL</span>, ...) </span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>{</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(width)) {</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>        width <span class="ot">&lt;-</span> <span class="fu">get_width</span>(x)</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>    }</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(width)) {</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>        width <span class="ot">&lt;-</span> <span class="fu">pillar_get_width</span>(x)</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>    }</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>    <span class="fu">as_glue</span>(<span class="fu">pillar_format_parts_2</span>(x, width)<span class="sc">$</span>aligned)</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
